services:
  git-scheduler:
    build: .
    container_name: git-deploy-scheduler
    ports:
      - "5001:5001"
    volumes:
      # Mount repository to monitor
      - /Volumes/Code/work/git-deploy-schedule:/repo
      # Mount config (read-only)
      - /Volumes/Code/work/git-deploy-schedule/config:/app/config:ro
      # Mount logs for persistence
      - /Volumes/Code/work/git-deploy-schedule/logs:/app/logs
      # Mount database for persistence
      - /Volumes/Code/work/git-deploy-schedule/database:/app/database
      # Mount SSH keys for git push
      - /Volumes/Code/work/git-deploy-schedule/.ssh:/root/.ssh:ro
    environment:
      - REPO_PATH=/repo
      - OLLAMA_URL=http://host.docker.internal:11434
      - OLLAMA_MODEL=llama3.2:3b
      - LOG_LEVEL=INFO
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}
    extra_hosts:
      - "oracle.local:host-gateway"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/api/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
